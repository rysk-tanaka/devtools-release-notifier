# 設計ドキュメント

devtools-release-notifierの設計ドキュメントです。システムアーキテクチャ、データフロー、クラス構造、処理シーケンスを図で説明します。

## 📚 ドキュメント一覧

### [システムアーキテクチャ](architecture.md)

システム全体のアーキテクチャを示す図です。

- **全体アーキテクチャ**: 外部サービス、GitHub Actions、アプリケーションコアの関係
- **コンポーネント説明**: 各モジュールの役割と責任
- **データストア**: 設定ファイルとキャッシュファイルの構造
- **デプロイメント構成**: GitHub Actionsでの実行環境
- **セキュリティ考慮事項**: シークレット管理とAPI認証
- **スケーラビリティ**: 拡張性の設計方針
- **技術選択の理由**: 各ライブラリ・ツールの選定理由

**主要な図:**

- 全体アーキテクチャ図（External Services + Application Core）
- データストアER図（Config + Cache構造）
- デプロイメント構成図（GitHub Actions統合）
- 将来の拡張可能性（非同期処理、DB、Web UI等）

### [データフロー](data-flow.md)

アプリケーション内のデータの流れを示す図です。

- **全体のデータフロー**: メイン処理の流れ
- **情報源からのデータ取得**: GitHub/Homebrew APIからの取得
- **翻訳フロー**: Claude APIによる翻訳処理
- **Discord通知フロー**: Discord Webhookへの送信
- **キャッシュ管理フロー**: 読み込み・保存・比較
- **エラーハンドリングフロー**: 各種エラーの処理方法
- **優先度ベースのソース選択**: フォールバック機構
- **時系列データフロー**: 処理のタイムライン

**主要な図:**

- 全体データフロー図（Start → End）
- 情報源取得シーケンス図
- 翻訳・通知フローチャート
- キャッシュ管理フロー
- エラーハンドリング決定木

### [クラス図](class-diagram.md)

Pythonクラスの構造と関係を示す図です。

- **主要クラス図**: UnifiedReleaseNotifierとその関連クラス
- **データモデル**: 設定ファイルとデータ構造
- **モジュール構成**: パッケージとモジュールの関係
- **依存関係図**: 標準ライブラリとサードパーティライブラリ
- **インターフェース詳細**: 各クラスの公開インターフェース
- **型定義**: TypedDictによる型定義
- **継承階層**: ReleaseSourceの継承関係

**主要な図:**

- 主要クラス図（UML形式）
- データモデルER図
- モジュール依存関係グラフ
- Factory Patternの実装
- 継承階層ツリー

### [シーケンス図](sequence-diagram.md)

処理の実行順序を時系列で示す図です。

- **メイン処理シーケンス**: エントリーポイントから完了まで
- **ツール処理シーケンス**: 各ツールの詳細な処理フロー
- **GitHub Releases取得**: Atomフィードからの情報取得
- **Homebrew API取得**: JSON APIからの情報取得
- **翻訳処理**: Claude APIとの通信
- **Discord通知**: Webhook送信プロセス
- **キャッシュ操作**: 読み込み・保存シーケンス
- **エラーハンドリング**: 各種エラーの捕捉と処理
- **GitHub Actions統合**: CI/CDでの実行フロー
- **優先度ベースのフォールバック**: ソース選択ロジック

**主要な図:**

- メイン処理シーケンス（GitHub Actions → Application）
- ツール処理詳細シーケンス
- API通信シーケンス（GitHub/Homebrew/Claude/Discord）
- エラーハンドリングフロー
- 完全な実行フローシーケンス

## 🎯 ドキュメントの読み方

### 初めての方

1. **[システムアーキテクチャ](architecture.md)** から読み始めることをおすすめします
   - システム全体の構造を理解できます
   - 各コンポーネントの役割を把握できます

2. **[データフロー](data-flow.md)** で処理の流れを確認
   - データがどのように変換されるかを理解できます
   - エラー処理の方針を把握できます

3. **[クラス図](class-diagram.md)** で実装の詳細を確認
   - Pythonコードの構造を理解できます
   - クラス間の関係を把握できます

4. **[シーケンス図](sequence-diagram.md)** で実行時の振る舞いを確認
   - 実際の処理順序を理解できます
   - API通信のタイミングを把握できます

### 開発者の方

#### 新機能追加時

1. **[システムアーキテクチャ](architecture.md)** で拡張ポイントを確認
2. **[クラス図](class-diagram.md)** で実装するクラスを決定
3. **[データフロー](data-flow.md)** でデータ変換を設計
4. **[シーケンス図](sequence-diagram.md)** で処理フローを確認

#### バグ修正時

1. **[シーケンス図](sequence-diagram.md)** で問題箇所を特定
2. **[データフロー](data-flow.md)** でデータの流れを追跡
3. **[クラス図](class-diagram.md)** で関連クラスを確認
4. **[システムアーキテクチャ](architecture.md)** で影響範囲を把握

#### コードレビュー時

1. **[クラス図](class-diagram.md)** で設計方針との整合性を確認
2. **[データフロー](data-flow.md)** でエラーハンドリングを確認
3. **[シーケンス図](sequence-diagram.md)** で処理順序の妥当性を確認

## 🔧 図の形式

すべての図は**Mermaid形式**で記述されています。

### 表示方法

#### GitHubで表示

GitHubは自動的にMermaid図をレンダリングします。各ドキュメントをGitHub上で開くだけで図が表示されます。

#### ローカルで表示

以下の方法でローカル環境でも表示できます：

1. **VSCodeの拡張機能**
   - [Markdown Preview Mermaid Support](https://marketplace.visualstudio.com/items?itemName=bierner.markdown-mermaid)をインストール
   - Markdownプレビューで自動的に表示されます

2. **Mermaid Live Editor**
   - [https://mermaid.live/](https://mermaid.live/) にアクセス
   - Mermaidコードをコピー＆ペーストして表示

3. **CLIツール**

   ```bash
   # mermaid-cliをインストール
   npm install -g @mermaid-js/mermaid-cli

   # PNGに変換
   mmdc -i docs/architecture.md -o architecture.png
   ```

### Mermaidについて

Mermaidは、テキストベースで図を記述できる強力なツールです。

**利点:**

- バージョン管理が容易（テキストファイル）
- GitHubでネイティブサポート
- コードと同じレビュープロセス
- 変更履歴が明確

**サンプル:**

```mermaid
graph LR
    A[Start] --> B[Process]
    B --> C[End]
```

詳細は [Mermaid Documentation](https://mermaid.js.org/) を参照してください。

## 📖 関連ドキュメント

- **[リポジトリREADME](../README.md)**: プロジェクト概要とセットアップ手順
- **[CLAUDE.md](../CLAUDE.md)**: 実装仕様とClaude Code向け指示書
- **[pyproject.toml](../pyproject.toml)**: プロジェクト定義と依存関係
- **[config.yml](../config.yml)**: アプリケーション設定

## 🔍 図の凡例

### カラーコーディング

各図では、以下のカラーコーディングを使用しています：

- **青系 (#4a90e2)**: メインコンポーネント・主要な処理
- **緑系 (#50c878, #28a745)**: 成功・開始・完了
- **オレンジ系 (#f39c12, #ffc107)**: キャッシュ・警告
- **赤系 (#dc3545, #e74c3c)**: エラー・終了
- **紫系 (#8e44ad)**: 翻訳・AI関連
- **Discord系 (#7289da)**: Discord通知
- **グレー系 (#6c757d)**: スキップ・無効

### 図の種類

- **Flowchart (flowchart TD/LR)**: 処理フローと条件分岐
- **Sequence Diagram (sequenceDiagram)**: 時系列での相互作用
- **Class Diagram (classDiagram)**: クラス構造と関係
- **ER Diagram (erDiagram)**: データ構造と関係
- **Graph (graph TB/LR)**: 一般的な関係図
- **Gantt Chart (gantt)**: 時系列タイムライン

## 🚀 今後の拡張

設計ドキュメントは、以下の機能追加時に更新される予定です：

1. **非同期処理**: httpxの非同期機能を活用した並列処理
2. **データベース統合**: SQLite/PostgreSQLによる永続化
3. **Web Dashboard**: 監視UIとステータス表示
4. **Slack統合**: 追加の通知チャンネル
5. **Email通知**: メール配信機能
6. **多言語サポート**: 日本語以外の言語対応

これらの拡張を実装する際は、設計ドキュメントを先に更新し、アーキテクチャの整合性を保つようにしてください。

## 📝 ドキュメント更新ガイドライン

### ドキュメントを更新する場合

1. **変更内容の明確化**: 何を追加・変更するか明確にする
2. **全体の一貫性**: すべてのドキュメントで一貫性を保つ
3. **図の更新**: コード変更と同時に図も更新する
4. **レビュー**: プルリクエストでドキュメントもレビュー対象に

### Mermaid図の編集

1. **[Mermaid Live Editor](https://mermaid.live/)** でプレビューしながら編集
2. **文法チェック**: Mermaidの文法エラーがないか確認
3. **可読性**: 図が複雑になりすぎないように注意
4. **カラーコーディング**: 既存の配色規則に従う

## 💡 質問・フィードバック

設計ドキュメントに関する質問やフィードバックは、GitHubのIssueまたはPull Requestで受け付けています。

- より詳細な説明が必要な箇所
- 図の改善提案
- 新しい図の追加リクエスト
- 誤りの指摘

お気軽にご連絡ください！
